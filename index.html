<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <!-- 引入 TailwindCSS -->
  <script src="static/js/tailwindcss.js"></script>
  <script src="static/js/vue.js"></script>
  <link rel="stylesheet" href="static/css/inter.css">
  <link rel="stylesheet" href="static/css/style.css">

  <title>儀錶板測試</title>
</head>

<body class="bg-[#272727] text-white">
  <div id="app" class="flex h-screen">
    <!-- Sidebar -->
    <div class="w-64 bg-gray-800 text-white p-4 overflow-y-auto" style="max-height: 100vh;">
      <h2 class="text-xl font-semibold mb-4 text-center">EAP Dashboard</h2>
      <ul class="text-center">
        <li v-for="(item, index) in menuItems" :key="index" class="mb-2">
          <a href="#"
             class="block py-2 px-4 rounded-md hover:bg-gray-700"
             @click.prevent="onMenuClick(index + 1)">
            {{ item.name }}
          </a>
        </li>
      </ul>
      <h4 class="text-sm font-semibold mb-3 text-center">Made By RuiYing</h4>
    </div>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col p-4 space-y-6 overflow-hidden relative">
      <div v-if="cardData.length > 0">
        <!-- 顯示當前頁數 -->
        <p>當前頁數：{{ currentPage }} / {{ totalPages }}</p>
        
        <!-- 表格容器，四個表格在同一行上 -->
        <div class="grid grid-cols-4 gap-4">
          <div v-for="(table, tableIndex) in groupedData" :key="tableIndex" class="bg-[#2a2a2a] p-4 rounded-md">
            <table class="w-full table-auto bg-black text-white">
              <thead>
                <tr>
                  <th class="px-4 py-2 border-b text-white text-left">IP Address</th>
                  <th class="px-4 py-2 border-b text-white text-left">Status</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="(item, rowIndex) in table" :key="rowIndex">
                  <td class="px-4 py-2 border-b text-white">{{ item.ip }}</td>
                  <td class="px-4 py-2 border-b text-white">{{ item.status }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- 分頁按鈕 -->
        <!-- :disabled="currentPage === totalPages">下一頁</button> -->
        <div class="mt-4">
          <button class="bg-gray-700 text-white px-4 py-2 rounded-md mr-2"
                  @click="prevPage"
                  :disabled="currentPage === 1">上一頁</button>
          <button class="bg-gray-700 text-white px-4 py-2 rounded-md"
                  @click="nextPage"
                  :disabled="currentPage === totalPages || totalPages === 0">下一頁</button>
        </div>
      </div>
      <div v-else>
        <p>沒有數據顯示。</p>
      </div>
    </div>
  </div>

  <script>
    new Vue({
      el: "#app",
      data() {
        return {
          menuItems: [],
          cardData: [], // 所有卡片數據
          currentCard: null, // 當前卡片
          currentPage: 1, // 當前頁
          pageSize: 60, // 每頁顯示條數
        };
      },
      computed: {
        // 總頁數
        totalPages() {
          return Math.ceil(this.cardData.length / this.pageSize);
        },
        // 當前頁數據
        paginatedData() {
          const startIndex = (this.currentPage - 1) * this.pageSize;
          const endIndex = startIndex + this.pageSize;
          return this.cardData.slice(startIndex, endIndex);
        },
        // 把每頁的數據分為 4 個表格，每個表格顯示 15 條數據
        groupedData() {
          const groups = [];
          let currentGroup = [];
          this.paginatedData.forEach((item, index) => {
            currentGroup.push(item);
            if (currentGroup.length === 15 || index === this.paginatedData.length - 1) {
              groups.push(currentGroup);
              currentGroup = [];
            }
          });
          return groups;
        }
      },
      async mounted() {
        await this.fetchMenuItems();
        if (this.menuItems.length > 0) {
          this.currentCard = 1; // 默認加載第一個卡片
          await this.fetchCardData(this.currentCard);
        }

        // 監聽鍵盤事件
        window.addEventListener('keydown', this.handleKeyDown);
      },

      methods: {
        async fetchMenuItems() {
          try {
            const response = await fetch("http://127.0.0.1:5000/menu-items");
            if (!response.ok) throw new Error(`Menu API error: ${response.status}`);
            this.menuItems = await response.json();
          } catch (error) {
            console.error("Error fetching menu items:", error);
          }
        },
        async fetchCardData(cardNumber) {
          try {
            const response = await fetch(`http://127.0.0.1:5000/card-data/${cardNumber}`);
            if (!response.ok) throw new Error(`API error: ${response.status}`);
            const rawData = await response.json();

            // 更新 cardData 並重置頁碼
            this.cardData = rawData;
            this.currentPage = 1;
          } catch (error) {
            console.error(`Error fetching card data for card ${cardNumber}:`, error);
            this.cardData = [];
          }
        },
        onMenuClick(cardNumber) {
          this.currentCard = cardNumber;
          this.fetchCardData(cardNumber);
        },

        prevPage() {
          this.currentPage = (this.currentPage - 2 + this.totalPages) % this.totalPages + 1;
        },

        nextPage() {
          this.currentPage = (this.currentPage % this.totalPages) + 1;
        },

        handleKeyDown(event) {
          if (event.key === 'ArrowLeft') {
            this.prevPage(); // 左箭頭，上一頁
          } else if (event.key === 'ArrowRight') {
            this.nextPage(); // 右箭頭，下一頁
          }
        },
      },
    });
  </script>
</body>


</html>
